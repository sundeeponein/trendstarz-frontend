
<div class="container">

  <form [formGroup]="registrationForm" (ngSubmit)="onSubmit()">
    
    <div class="row my-5">
      <div class="col-6">
        <label>Username <span class="text-danger">*</span></label>
        <input formControlName="username" type="text" class="form-control w-100" required />
        <div *ngIf="submitted && registrationForm.get('username')?.invalid" class="text-danger mt-1">Please enter your username.</div>
      </div>
      <div class="col-6">
        <label>Phone Number <span class="text-danger">*</span></label>
        <input formControlName="phoneNumber" type="text" class="form-control w-100" required />
        <div *ngIf="submitted && registrationForm.get('phoneNumber')?.invalid" class="text-danger mt-1">Please enter your phone number.</div>
      </div>
      <div class="col-6">
        <label>Name <span class="text-danger">*</span></label>
        <input formControlName="name" type="text" class="form-control w-100" required />
        <div *ngIf="submitted && registrationForm.get('name')?.invalid" class="text-danger mt-1">Please enter your name.</div>
      </div>
      <div class="col-6">
        <label>Email <span class="text-danger">*</span></label>
        <input formControlName="email" type="email" class="form-control w-100" required />
        <div *ngIf="submitted && registrationForm.get('email')?.invalid" class="text-danger mt-1">Please enter a valid email address.</div>
      </div>
      <div class="col-6">
        <label>Password <span class="text-danger">*</span></label>
        <input formControlName="password" type="password" class="form-control w-100" required />
        <div *ngIf="submitted && registrationForm.get('password')?.invalid" class="text-danger mt-1">Please enter your password.</div>
      </div>
      <div class="col-6">
        <label>Confirm Password <span class="text-danger">*</span></label>
        <input formControlName="confirmPassword" type="password" class="form-control w-100" required />
        <div *ngIf="submitted && registrationForm.get('confirmPassword')?.invalid" class="text-danger mt-1">Please confirm your password.</div>
      </div>
      <div class="col-6">
        <label>Payment Option <span class="text-danger">*</span></label>
        <select formControlName="paymentOption" class="form-control w-100">
          <option value="free">Free (Contact/Social hidden)</option>
          <option value="premium">Premium (Contact/Social visible, 3 images)</option>
        </select>
        <div *ngIf="submitted && registrationForm.get('paymentOption')?.invalid" class="text-danger mt-1">Please select a payment option.</div>
      </div>
      <div class="col-6" formGroupName="location">
        <label>State <span class="text-danger">*</span></label>
        <select formControlName="state" class="form-control w-100">
          <option *ngFor="let state of states" [value]="state._id">{{ state.name }}</option>
        </select>
        <div *ngIf="submitted && registrationForm.get('location.state')?.invalid" class="text-danger mt-1">Please select your state.</div>
      </div>
      <div class="col-6">
        <label>Languages <span class="text-danger">*</span></label>
        <ng-select
          [items]="languagesList"
          bindLabel="name"
          bindValue="_id"
          [multiple]="true"
          [searchable]="true"
          [closeOnSelect]="false"
          [clearable]="true"
          formControlName="languages"
          class="form-control w-100"
        >
          <ng-template ng-option-tmp let-item="item" let-selected="selected">
            <input type="checkbox" [checked]="selected" /> {{ item.name }}
          </ng-template>
        </ng-select>
        <div *ngIf="submitted && registrationForm.get('languages')?.invalid" class="text-danger mt-1">Please select at least one language.</div>
      </div>
      <div class="col-6">
        <label>Categories <span class="text-danger">*</span></label>
        <ng-select
          [items]="categoriesList"
          bindLabel="name"
          bindValue="_id"
          [multiple]="true"
          [searchable]="true"
          [closeOnSelect]="false"
          [clearable]="true"
          formControlName="categories"
          class="form-control w-100"
        >
          <ng-template ng-option-tmp let-item="item" let-selected="selected">
            <input type="checkbox" [checked]="selected" /> {{ item.name }}
          </ng-template>
        </ng-select>
        <div *ngIf="submitted && registrationForm.get('categories')?.invalid" class="text-danger mt-1">Please select at least one category.</div>
      </div>
      <!-- Profile Image Upload (single image for now) -->
      <div class="col-12 mt-3">
        <label>Profile Image <span class="text-danger">*</span></label>
        <div *ngIf="profileImagePreview" class="mt-2">
          <img [src]="profileImagePreview" alt="Profile Preview" style="max-width: 120px; max-height: 120px; display: block;" />
        </div>
        <div>
          <button type="button" (click)="removeProfileImage(0)" *ngIf="profileImagePreview">Remove</button>
          <input type="file" accept="image/*" (change)="onProfileImageFileChange($event)" [required]="!profileImagePreview" />
        </div>
        <div *ngIf="!profileImagePreview && submitted" class="text-danger mt-1">Profile image is required.</div>
      </div>
      <!-- Social Media: Only allow adding for premium, hide for free -->
      <div class="col-12 mt-3" formArrayName="socialMedia">
        <div *ngFor="let sm of socialMediaFormArray.controls; let i = index" [formGroupName]="i" class="row">
          <label>Social Media  <span class="text-danger">*</span></label>
          <div class="col-3">
            <label>Social Platform</label>
            <select formControlName="platform"  class="form-control w-100">
              <option *ngFor="let s of socialMediaList" [value]="s._id">{{ s.name }}</option>
            </select>
          </div>
          <div class="col-3">
            <label>Handle Name</label>
            <input formControlName="handle" type="text" required  class="form-control w-100" />
          </div>
          <div class="col-3">
            <label>Tier</label> <i class="bi bi-info-circle-fill" style="cursor:pointer;" data-bs-toggle="modal" data-bs-target="#tierInfoModal" title="Select the tier for this social media account"></i>
            <select formControlName="tier" class="form-control w-100">
              <option *ngFor="let t of tiers" [value]="t.name">{{ t.name }}</option>
            </select>
          </div>
          <div class="col-3">
            <label>Followers/Subscribers Count</label>
            <input formControlName="followersCount" type="number" required  class="form-control w-100" />
            <button type="button" (click)="removeSocialMedia(i)" *ngIf="socialMediaFormArray.length > 1">Remove</button>
          </div>
        </div>
        <button type="button" (click)="addSocialMedia()">Add Social Media</button>
      </div>
      <div class="col-6 mt-3" formGroupName="contact">
        <label>Contact Options  <span class="text-danger">*</span></label>
        <div class="row">
          <div class="col"><label><input type="checkbox" formControlName="whatsapp" /> WhatsApp </label></div>
          <div class="col"><label><input type="checkbox" formControlName="email" /> Email </label></div>
          <div class="col"><label><input type="checkbox" formControlName="call" /> Call </label></div>
        </div>
        <div *ngIf="registrationForm.get('contact')?.invalid && registrationForm.get('contact')?.touched" style="color:red">Contact is required.</div>
      </div>

      <div *ngIf="registrationSuccess" class="text-success font-weight-bold my-3">
        Registration successful! <a href="/login" class="btn btn-link p-0 m-0 align-baseline">Login here</a>
      </div>
      <div *ngIf="registrationError" class="text-danger font-weight-bold my-3">
        {{ registrationError }}
      </div>
      <div class="col-12 mt-3">
        <button type="submit" class="btn btn-primary" [disabled]="registrationForm.invalid || !profileImagePreview">Register</button>
      </div>
    </div>
  </form>
  <pre>{{ registrationForm.errors | json }}</pre>
  <!-- <pre>{{ registrationForm.value | json }}</pre> -->




<!-- Tier Info Modal -->
<div class="modal fade" id="tierInfoModal" tabindex="-1" aria-labelledby="tierInfoModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="tierInfoModalLabel">Tier Information</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <table class="table table-bordered table-striped">
          <thead>
            <tr>
              <th>Name</th>
              <th>Description</th>
              <th>Icon</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let tier of tiers">
              <td>{{ tier.name }}</td>
              <td>{{ tier.desc }}</td>
              <td>
                <i *ngIf="tier.icon" [class]="tier.icon" style="font-size: 1.5rem;"></i>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>