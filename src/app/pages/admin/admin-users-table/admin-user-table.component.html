<div class="container-fluid p-4">

  <div class="admin-tabs">
  <button class="btn btn-outline-primary me-2" [class.active]="activeTab === 'influencer'" [class.btn-primary]="activeTab === 'influencer'" [class.btn-outline-primary]="activeTab !== 'influencer'" (click)="setTab('influencer')">Influencers</button>
  <button class="btn btn-outline-primary" [class.active]="activeTab === 'brand'" [class.btn-primary]="activeTab === 'brand'" [class.btn-outline-primary]="activeTab !== 'brand'" (click)="setTab('brand')">Brands</button>
  </div>
  
  <div *ngIf="activeTab === 'influencer'">
    <table class="table table-hover admin-table">
      <thead>
        <tr>
          <th>Profile</th>
          <th>Name</th>
          <th>Username</th>
          <th>Email & Phone</th>
          <th>Categories</th>
          <th>Languages</th>
          <th>State</th>
          <th>Social Media</th>
          <th>Premium</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let user of influencers">
          <td>
            <img [src]="getProfileImage(user)" alt="Profile" width="40" height="40">
          </td>
          <td>{{ user.name || '-' }}</td>
          <td>{{ user.username || '-' }}</td>
          <td>{{ user.email || '-' }} <br> <small>{{ user.phoneNumber || '-' }}</small></td>
          <td>{{ user.categories && user.categories.length ? user.categories.join(', ') : '-' }}</td>
          <td>{{ user.languages && user.languages.length ? user.languages.join(', ') : '-' }}</td>
          <td>{{ user.location?.state || '-' }}</td>
          <td>
            <span *ngIf="user.socialMedia && user.socialMedia.length; else noSocial">
              <span *ngFor="let sm of user.socialMedia">
                {{ sm.platform || '-' }}: {{ sm.handle || '-' }} <span *ngIf="sm.followersCount">({{ sm.followersCount }})</span><br>
              </span>
            </span>
            <ng-template #noSocial>-</ng-template>
          </td>
          <td>
            <ng-container *ngIf="user.isPremium; else freeTpl">
              Premium
              <span *ngIf="getPremiumPeriod(user) as period">
                <span *ngIf="user.premiumStart || user.acceptedAt">
                  — {{ user.premiumStart ? 'Paid on' : 'Accepted on' }}
                  {{ (user.premiumStart || user.acceptedAt) | date:'dd MMM yyyy' }}
                </span>
                <span>
                  <br>from {{ period.start | date:'dd MMM yyyy' }}
                  <span *ngIf="period.end"> till {{ period.end | date:'dd MMM yyyy' }}</span>
                </span>
                <div style="font-size: 0.8em; color: #888; margin-top: 2px;">
                  <!-- Debug: show raw date fields -->
                  <div>premiumStart: {{ user.premiumStart }}</div>
                  <div>premiumEnd: {{ user.premiumEnd }}</div>
                  <div>acceptedAt: {{ user.acceptedAt }}</div>
                </div>
              </span>
            </ng-container>
            <ng-template #freeTpl>Free</ng-template>
          </td>
          <td>{{ user.status || '-' }}</td>
          <td class="actions">
            <button class="btn btn-success btn-sm me-1" (click)="acceptUser(user._id)" [disabled]="user.status === 'accepted'" title="Accept" tooltip="Accept">
              <i class="bi bi-check-circle-fill"></i>
            </button>
            <button class="btn btn-warning btn-sm" (click)="declineUser(user._id)" title="Decline" tooltip="Decline">
              <i class="bi bi-x-circle-fill"></i>
            </button>
            <button class="btn btn-danger btn-sm" (click)="deleteUser(user._id)" title="Delete" tooltip="Delete">
              <i class="bi bi-trash-fill"></i>
            </button>
            <button class="btn btn-outline-primary btn-sm me-1" *ngIf="!user.isPremium" (click)="openPremiumModal(user._id, 'influencer')">Set Premium</button>
            <button class="btn btn-outline-secondary btn-sm" *ngIf="user.isPremium" (click)="setPremium(user._id, false, 'influencer')">Set Free</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div *ngIf="activeTab === 'brand'">
    <table class="admin-table table table-hover">
      <thead>
        <tr>
          <th>Logo</th>
          <th>Brand Name</th>
          <th>Email & Phone</th>
          <th>Categories</th>
          <th>State</th>
          <th>Products</th>
          <th>Social Media</th>
          <th>Premium</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let user of brands">
          <td>
            <img [src]="getBrandLogo(user)" alt="Logo" width="40" height="40">
          </td>
          <td>{{ user.brandName || '-' }}</td>
          <td>{{ user.email || '-' }} <br> <small>{{ user.phoneNumber || '-' }}</small></td>
          <td>{{ user.categories && user.categories.length ? user.categories.join(', ') : '-' }}</td>
          <td>{{ user.location?.state || '-' }}</td>
          <td>
            <ng-container *ngIf="user.products && user.products.length; else noProducts">
              <ng-container *ngFor="let product of user.products; let i = index">
                <ng-container *ngIf="product && product.imageUrl; else textProduct">
                  <a href="#" (click)="$event.preventDefault(); onProductClick(user, product, i)" title="View Product Image">
                    <img [src]="product.imageUrl" alt="Product Image" width="32" height="32" style="object-fit:cover; border-radius:4px; margin-right:4px;">
                  </a>
                </ng-container>
                <ng-template #textProduct>
                  <span>{{ product && product.name ? product.name : (typeof product === 'string' ? product : 'Product ' + (i+1)) }}</span>
                </ng-template>
                <span *ngIf="i < user.products.length - 1">, </span>
              </ng-container>
            </ng-container>
            <ng-template #noProducts>-</ng-template>
          </td>
          <td>
            <span *ngIf="user.socialMedia && user.socialMedia.length; else noSocialBrand">
              <span *ngFor="let sm of user.socialMedia">
                {{ sm.platform || '-' }}: {{ sm.handle || '-' }}<br>
              </span>
            </span>
            <ng-template #noSocialBrand>-</ng-template>
          </td>
          <td>
            <ng-container *ngIf="user.isPremium; else freeTplBrand">
              Premium
              <span *ngIf="getPremiumPeriod(user) as period">
                <span *ngIf="user.premiumStart || user.acceptedAt">
                  — {{ user.premiumStart ? 'Paid on' : 'Accepted on' }}
                  {{ (user.premiumStart || user.acceptedAt) | date:'dd MMM yyyy' }}
                </span>
                <span>
                  <br>from {{ period.start | date:'dd MMM yyyy' }}
                  <span *ngIf="period.end"> till {{ period.end | date:'dd MMM yyyy' }}</span>
                </span>
                <div style="font-size: 0.8em; color: #888; margin-top: 2px;">
                  <!-- Debug: show raw date fields -->
                  <div>premiumStart: {{ user.premiumStart }}</div>
                  <div>premiumEnd: {{ user.premiumEnd }}</div>
                  <div>acceptedAt: {{ user.acceptedAt }}</div>
                </div>
              </span>
            </ng-container>
            <ng-template #freeTplBrand>Free</ng-template>
          </td>
          <td>{{ user.status === 'accepted' ? 'Accepted' : (user.status || '-') }}</td>
          <td class="actions">
            <button class="btn btn-success btn-sm me-1" (click)="acceptUser(user._id)" [disabled]="user.status === 'accepted'">
              <i class="bi bi-check-circle-fill"></i>
            </button>
            <button class="btn btn-warning btn-sm me-1" (click)="declineUser(user._id)">
              <i class="bi bi-x-circle-fill"></i>
            </button>
            <button class="btn btn-danger btn-sm me-1" (click)="deleteUser(user._id)">
              <i class="bi bi-trash-fill"></i>
            </button>
            <!-- Restore and Delete Permanently buttons removed -->
            <button class="btn btn-outline-primary btn-sm me-1" *ngIf="!user.isPremium" (click)="openPremiumModal(user._id, 'brand')">Set Premium</button>
            <button class="btn btn-outline-secondary btn-sm" *ngIf="user.isPremium" (click)="setPremium(user._id, false, 'brand')">Set Free</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
  
</div>





  <!-- Premium Duration Modal (always present, not inside tab divs) -->
  <div *ngIf="showPremiumModal"  class="modal show" tabindex="-1" style="display: block; background: rgba(0,0,0,0.4);">
    
    <div class="modal-dialog modal-dialog-centered premium-modal">

      <div class="modal-content">
        <div class="modal-header">
          <h4>Select Premium Duration</h4>
        </div>
        <div class="modal-body">
          <label><input type="radio" name="premiumDurationGroup" [value]="'1m'" [(ngModel)]="premiumDuration"> 1 Month</label><br>
          <label><input type="radio" name="premiumDurationGroup" [value]="'3m'" [(ngModel)]="premiumDuration"> 3 Months</label><br>
          <label><input type="radio" name="premiumDurationGroup" [value]="'1y'" [(ngModel)]="premiumDuration"> 1 Year</label><br>
          <div class="modal-actions">
            <button (click)="confirmPremium()" [disabled]="!premiumDuration">Confirm</button>
            <button (click)="closePremiumModal()">Cancel</button>
          </div>
          <div class="modal-features">
            <strong>Premium Features:</strong>
            <ul>
              <li>Everything in Pro</li>
              <li>Post unlimited campaigns per month</li>
              <li>Track live analytics for 15 posts at a time</li>
              <li>5% marketplace fee</li>
              <li>Priority customer support</li>
              <li>25 Influencer engagement & audience reports</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
